#!/usr/bin/env zsh

header() { echo -e "$(tput sgr 0 1)$(tput setaf 6)$1$(tput sgr0)" }

is_git() {
  [[ $(command git rev-parse --is-inside-work-tree 2>/dev/null) == true ]]
}

force=false

for d in */ ; do
    pushd "$d" > /dev/null
    header "Cleaning $d..."

    if is_git; then
        while getopts "f" flag; do
            case $flag in
              f) force=true ;;
              *) echo 'Error in command line parsing' >&2
                 exit 1
            esac
        done

        if [[ $force == true ]]; then
            git clean -fdx
            git reset --hard
        fi

        find . -name 'node_modules' -type d -prune -exec rm -rf '{}' +
        find . -name '.cache' -type d -prune -exec rm -rf '{}' +
        rm -rf ./vendor 2>/dev/null
    else
        echo "Not a Git repository"
    fi

    echo
    popd > /dev/null
done


